import Head from 'next/head'
import { Header, Hero, Row } from '../companets' // hamma companentlani index ga yozin indexni chaqirib olsak osonroq
import { useEffect } from 'react';
import { API_REQUEST } from '../services/api.service';
import { getServers } from 'dns';
import { GetServerSideProps } from 'next';
import { IMovie } from '../interfaces/app.interface';

export default function Home({
  trending, 
  topReated, 
  tvTopReated, 
  popular,
  documentary,
  Action,
  kids,
  horror,
  romance
}: HomeProps): JSX.Element {
  // useEffect(() => {
  //   fetch(API_REQUEST.trending)
  //   .then(res => res.json())
  //   .then(data => console.log(data))
  // }, [])

  return (
    <div className='relative min-h-screen '>
      <Head>
        <title>Home - Jahon</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/logo.svg" />
      </Head>
      <Header/>
      <main className='relative pl-4 pb-24 lg:space-y-24 lg:pl-16'>
       {/* Hero */}
       <Hero trending={trending}/>
       <section>
        {/* Row */}
       <Row title='Top Rated' movies={topReated} />
        {/* BigRow */}
       <Row title='Featured Tv Shows' movies={tvTopReated} isBig={true}/>
        {/* Row */}
       <Row title='Popular' movies={popular} />
        {/* BigRow */}
       <Row title='Romance' movies={romance} />
       <Row title='Action' movies={Action.reverse()} isBig={true}/>
       <Row title='Kids' movies={kids}/>
       <Row title='Horror' movies={horror}/>
       <Row title='documentary' movies={documentary} isBig={true}/>
       </section>
      </main>
    </div>
  )
}

// SSR yozish
export const getServerSideProps: GetServerSideProps<HomeProps> = async () => {
  const trending = await fetch(API_REQUEST.trending).then(res => res.json());
  const topReated = await fetch(API_REQUEST.top_reted).then(res => res.json());
  const tvTopReated = await fetch(API_REQUEST.tv_top_reted).then(res => res.json());
  const popular = await fetch(API_REQUEST.popular).then(res => res.json());
  const documentary = await fetch(API_REQUEST.documentary).then(res => res.json());
  const Action = await fetch(API_REQUEST.action).then(res => res.json());
  const kids = await fetch(API_REQUEST.kids).then(res => res.json());
  const horror = await fetch(API_REQUEST.horror).then(res => res.json());
  const romance = await fetch(API_REQUEST.romance).then(res => res.json());

  // kirgandan poshqa page ga o'tib ketadi
  // if(trending.results.length) {
  //   return{
  //     notFound: true, // error 404 ga yuboradi
  //   }
  // }

  return{
    props: {
      trending: trending.results,
      topReated: topReated.results,
      tvTopReated: tvTopReated.results,
      popular: popular.results,
      documentary: documentary.results,
      Action: Action.results,
      kids: kids.results,
      horror: horror.results,
      romance: romance.results,
    }
  }
}
interface HomeProps {
  trending: IMovie[];
  topReated: IMovie[]
  tvTopReated: IMovie[]
  popular: IMovie[]
  documentary: IMovie[]
  Action: IMovie[]
  kids: IMovie[]
  horror: IMovie[]
  romance: IMovie[]
}